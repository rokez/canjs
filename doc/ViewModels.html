<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE -- ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: [object Object]
	@page ViewModels
######################################################################## -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
	<link rel="stylesheet" type="text/css" href="./static/bundles/bit-docs-site/static.css">
	
</head>

<body>
  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger">Menu</label>
  <header><nav class="navbar">
	<a class="brand" href="../index.html">CanJS</a>

	<ul class="bitovi-menu">
		<li class="dropdown">
			<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
			<ul class="dropdown-menu">
				<li><a href="http://bitovi.com">Bitovi.com</a></li>
				<li><a href="http://bitovi.com/blog/">Blog</a></li>
				<li><a href="http://bitovi.com/consulting/">Consulting</a></li>
				<li><a href="http://bitovi.com/training/">Training</a></li>
				<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
			</ul>
		</li>
	</ul>

	<ul class="navbar-items">
		<li class="dropdown">
				<a href="http://github.com/canjs/canjs">Github</a>
				<ul class="dropdown-menu">
      		<li><a href="http://github.com/canjs/can-connect">can-connect</a></li>
					<li><a href=".">can-set</a></li>
					<li><a href=".">can-compute</a></li>
					<li><a href=".">can-component</a></li>
				</ul>
		</li>
		<li>
			<a href="https://gitter.im/canjs/canjs">Chat</a>
		</li>
		<li>
			<a href="http://forums.donejs.com/c/canjs">Forum</a>
		</li>
	</ul>

</nav>
</header>
  	<div class="main-container">
  
  	<nav class="sidebar">
    
        
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-core.html">
							Core
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-ecosystem.html">
							Ecosystem
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-infrastructure.html">
							Infrastructure
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-legacy.html">
							Legacy
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="page"
							href="guides.html">
							Guides
						</a>
						
							
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Why.html">
							Why CanJS?
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Using.html">
							Setting up CanJS
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="page"
							href="Tutorial.html">
							Getting Started Tutorial
						</a>
						
							
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Setup.html">
							Setup
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="ApplicationDesign.html">
							Application Design
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Constructors.html">
							Constructors
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Observables.html">
							Observables
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="TheDefinePlugin.html">
							The Define Plugin
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="StacheTemplates.html">
							Stache Templates
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="AppStateAndRouting.html">
							App State and Routing
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Components.html">
							Components
						</a>
						
					</li>
				

			
		
			
				
					<li class="current
                               parent
                               expanded">
						<a class="page"
							href="ViewModels.html">
							View Models
						</a>
						
							

						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="DataModelsAndFixtures.html">
							Data Models and Fixtures
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Routing.html">
							Routing
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="LoadingStates.html">
							Loading States
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="EventHandling.html">
							Event Handling
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="WebServiceCommunication.html">
							Web Service Communication
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Recap.html">
							Recap
						</a>
						
					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Recipes.html">
							Recipes
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="migrating.html">
							Migrating to 3.0
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="roadmap.html">
							Roadmap
						</a>
						
					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
	</ul>


    
</nav>
  

  <div class="content-container">
    <article>
    	
    		<section class="title">
	<h1>View Models</h1>
</section>

    	

        

    	
    		
    			<section class="description">
    
</section>

    		
    	

    
    
    
    
    


    	
    		
    			<section class="body">
    <div class="getting-started">
<hr />
<p><strong>In this Chapter</strong></p>
<ul>
<li>Getting and Setting Scope Properties</li>
<li>View Models</li>
</ul>
<p>Get the code for: <a href="/guides/examples/PlaceMyOrder/ch-5_canjs-getting-started.zip">chapter: view models</a></p>
<hr />
<p>In the last chapter, we created the <code>currentRestaurant</code> component, and included it in our
template. Let’s add a little bit more advanced functionality: two select elements,
where selecting an option in the first one changes the options in the second.</p>
<p>Open your <code>components/restaurant_list/restaurant_list.stache</code> and edit it as follows:</p>
<pre><code>&lt;div class=&quot;restaurants&quot;&gt;
  &lt;h2 class=&quot;page-header&quot;&gt;Restaurants&lt;/h2&gt;
  &lt;form class=&quot;form&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label&gt;State&lt;/label&gt;
      &lt;select {($value)}=&quot;state&quot;&gt;
        {{^if state}}
        &lt;option value=&quot;&quot;&gt;Choose a state&lt;/option&gt;
        {{/if}}
        {{#each states}}
        &lt;option value=&quot;{{name}}&quot;&gt;{{name}}&lt;/option&gt;
        {{/each}}
      &lt;/select&gt;
    &lt;/div&gt;
    &lt;!-- The city select will go here --&gt;
  &lt;/form&gt;

  &lt;!-- Restaurants code will go here --&gt;
&lt;/div&gt;
</code></pre>
<p>In the above code, you can see one select element for selecting a state. You can
see <code>{{#each}}</code> being used to create the list of options. You can also see that
if no state is selected, the “Choose a state” message is included as an option
until one has been selected.</p>
<p>Let’s modify our <code>components/restaurant_list/restaurant_list.js</code> file to include
what’s needed for our partial:</p>
<pre><code>can.Component.extend({
  tag: 'pmo-restaurant-list',
  template: can.view('components/restaurant_list/restaurant_list.stache'),
  viewModel: can.Map.extend({
    define: {
      state: {
        value: null,
        set: function(newState) {
          if (newState) {
            alert('Selected “' + newState + '” state.');
          }
          return newState;
        }
      },
      states: {
        value: [
          {
            cities: ['Green Bay', 'Milwaukee'],
            name: 'Wisconsin'
          },
          {
            cities: ['Detroit', 'Ann Arbor'],
            name: 'Michigan'
          },
          {
            cities: ['Chicago', 'Peoria'],
            name: 'Illinois'
          }
        ]
      },
      // City code will go here
    }
  })
});
</code></pre>
<p>Here we’re using <a href="TheDefinePlugin.html">the define plugin</a> to set up two new
properties:</p>
<ul>
<li><code>state</code> to keep track of the selected state, and</li>
<li><code>states</code> with the list of states that can be selected.</li>
</ul>
<p>In the <code>state</code> setter, we’re showing an alert when a new state is selected.
If you refresh the Restaurants page, you should see a select element with the
states as options; when you select a state, an alert will appear with the selected
state’s name.</p>
<p><img src="../can/guides/images/view-models/view_model_state.png" alt="set up state selector" /></p>
<h2>Getting and Setting Scope Properties</h2>
<p>It’s important to understand how to get and set the properties
of the view model. Getting and setting are done through the <code>attr</code> function off of
the <code>viewModel</code> object, in this case <code>this</code> is bound to the scope, because we’re
within a method of the scope. Let’s look at an example.</p>
<p>Open up <code>components/restaurant_list/restaurant_list.js</code> and replace this:</p>
<pre><code>// City code will go here
</code></pre>
<p>with this:</p>
<pre><code>      cities: {
        get: function() {
          var state = this.attr('state');
          return state &amp;&amp; this.attr('citiesByState')[state];
        }
      },
      citiesByState: {
        get: function() {
          var citiesByState = {};
          this.attr('states').forEach(function(state) {
            citiesByState[state.name] = state.cities;
          });
          return citiesByState;
        }
      },
      city: {
        value: null
      }
</code></pre>
<p>This code creates three new properties:</p>
<ul>
<li><code>city</code> with the name of the city that’s selected,</li>
<li><code>citiesByState</code> which is an object that has the list of cities by state name, and</li>
<li><code>cities</code> which is the list of cities for the selected state.</li>
</ul>
<p>Let’s update the stache file to take advantage of these new properties.
Open <code>components/restaurant_list/restaurant_list.stache</code> and find this line:</p>
<pre><code>&lt;!-- The city select will go here --&gt;
</code></pre>
<p>and replace it with this:</p>
<pre><code>    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label&gt;City&lt;/label&gt;
      &lt;select {($value)}=&quot;city&quot;&gt;
        {{^if city}}
        &lt;option value=&quot;&quot;&gt;Choose a city&lt;/option&gt;
        {{/if}}
        {{#each cities}}
        &lt;option&gt;{{.}}&lt;/option&gt;
        {{/each}}
      &lt;/select&gt;
    &lt;/div&gt;
</code></pre>
<p>This new part of the template will show a select element with the cities
for the selected state as options. Note that when no city is selected,
the element will have a “Choose a city” option.</p>
<p>If you refresh the Restaurants page, you’ll see the new city select
element that has options as soon as you select a state. However, there’s
a bug: if you change the state, the first city for the new state is automatically
selected, even though the user hasn’t made a city choice. Let’s fix this
by nullifying the city when the state changes. Find the state setter:</p>
<pre><code>        set: function(newState) {
          if (newState) {
            alert('Selected “' + newState + '” state.');
          }
          return newState;
        }
</code></pre>
<p>and replace it with this:</p>
<pre><code>        set: function() {
          // Remove the city when the state changes
          this.attr('city', null);
        }
</code></pre>
<p>Notice that we are nullifying the city property when the state changes.
If you refresh the Restaurants page in your browser, select a state,
select a city, then select another state, you’ll see the “Choose a city”
option in the city select element instead of the first city in that
state.</p>
<p><img src="../can/guides/images/view-models/view_model_city.png" alt="set up state selector" /></p>
<h2>Separating the Component &amp; View Model</h2>
<p>It’s considered a best practice to keep your <code>can.Components</code>
thin. This helps maintain readability and maintainability. To accomplish this,
you extract your scope from the <code>can.Component</code> into a <code>can.Map</code>.</p>
<p>Open up <code>components/restaurant_list/restaurant_list.js</code> and replace the
contents of the file with this:</p>
<pre><code>var RestaurantListViewModel = can.Map.extend({
  define: {
    state: {
      value: null,
      set: function() {
        // Remove the city when the state changes
        this.attr('city', null);
      }
    },
    states: {
      value: [
        {
          cities: ['Green Bay', 'Milwaukee'],
          name: 'Wisconsin'
        },
        {
          cities: ['Detroit', 'Ann Arbor'],
          name: 'Michigan'
        },
        {
          cities: ['Chicago', 'Peoria'],
          name: 'Illinois'
        }
      ]
    },
    cities: {
      get: function() {
        var state = this.attr('state');
        return state &amp;&amp; this.attr('citiesByState')[state];
      }
    },
    citiesByState: {
      get: function() {
        var citiesByState = {};
        this.attr('states').forEach(function(state) {
          citiesByState[state.name] = state.cities;
        });
        return citiesByState;
      }
    },
    city: {
      value: null
    }
  }
});

can.Component.extend({
  tag: 'pmo-restaurant-list',
  template: can.view('components/restaurant_list/restaurant_list.stache'),
  viewModel: RestaurantListViewModel
});
</code></pre>
<p>If you go back out to your application and refresh the page, it should all
look and work the same. What we’ve done, by separating out the view model,
is make the code easier to read and maintain.</p>
<p>In the next chapter, we’ll learn about working with more realistic data by
adding REST service interaction with <code>can.Model</code>.</p>
<hr />
<p><span class="pull-left"><a href="Components.html">&lsaquo; Components</a></span>
<span class="pull-right"><a href="DataModelsAndFixtures.html">Data Models and Fixtures &rsaquo;</a></span></p>
</div>

</section>

    		
    	

    </article>
  </div>
</div>

  <footer><p>CanJS is part of <a href="http://donejs.com">DoneJS</a>. Created and maintained by the open source team at <a href="http://bitovi.com">Bitovi</a>. <strong>Currently v3.0.0.</strong></p></footer>
	<script type="text/javascript">
		var docObject = {"content":"<div class=\"main-container\">\n  \n  \t<nav class=\"sidebar\">\n    \n        \n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-core.html\">\n\t\t\t\t\t\t\tCore\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-ecosystem.html\">\n\t\t\t\t\t\t\tEcosystem\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-infrastructure.html\">\n\t\t\t\t\t\t\tInfrastructure\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-legacy.html\">\n\t\t\t\t\t\t\tLegacy\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"guides.html\">\n\t\t\t\t\t\t\tGuides\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Why.html\">\n\t\t\t\t\t\t\tWhy CanJS?\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Using.html\">\n\t\t\t\t\t\t\tSetting up CanJS\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Tutorial.html\">\n\t\t\t\t\t\t\tGetting Started Tutorial\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Setup.html\">\n\t\t\t\t\t\t\tSetup\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"ApplicationDesign.html\">\n\t\t\t\t\t\t\tApplication Design\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Constructors.html\">\n\t\t\t\t\t\t\tConstructors\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Observables.html\">\n\t\t\t\t\t\t\tObservables\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"TheDefinePlugin.html\">\n\t\t\t\t\t\t\tThe Define Plugin\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"StacheTemplates.html\">\n\t\t\t\t\t\t\tStache Templates\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"AppStateAndRouting.html\">\n\t\t\t\t\t\t\tApp State and Routing\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Components.html\">\n\t\t\t\t\t\t\tComponents\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"current\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"ViewModels.html\">\n\t\t\t\t\t\t\tView Models\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"DataModelsAndFixtures.html\">\n\t\t\t\t\t\t\tData Models and Fixtures\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Routing.html\">\n\t\t\t\t\t\t\tRouting\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"LoadingStates.html\">\n\t\t\t\t\t\t\tLoading States\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"EventHandling.html\">\n\t\t\t\t\t\t\tEvent Handling\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"WebServiceCommunication.html\">\n\t\t\t\t\t\t\tWeb Service Communication\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Recap.html\">\n\t\t\t\t\t\t\tRecap\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Recipes.html\">\n\t\t\t\t\t\t\tRecipes\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"migrating.html\">\n\t\t\t\t\t\t\tMigrating to 3.0\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"roadmap.html\">\n\t\t\t\t\t\t\tRoadmap\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n    \n</nav>\n  \n\n  <div class=\"content-container\">\n    <article>\n    \t\n    \t\t<section class=\"title\">\n\t<h1>View Models</h1>\n</section>\n\n    \t\n\n        \n\n    \t\n    \t\t\n    \t\t\t<section class=\"description\">\n    \n</section>\n\n    \t\t\n    \t\n\n    \n    \n    \n    \n    \n\n\n    \t\n    \t\t\n    \t\t\t<section class=\"body\">\n    <div class=\"getting-started\">\n<hr />\n<p><strong>In this Chapter</strong></p>\n<ul>\n<li>Getting and Setting Scope Properties</li>\n<li>View Models</li>\n</ul>\n<p>Get the code for: <a href=\"/guides/examples/PlaceMyOrder/ch-5_canjs-getting-started.zip\">chapter: view models</a></p>\n<hr />\n<p>In the last chapter, we created the <code>currentRestaurant</code> component, and included it in our\ntemplate. Let’s add a little bit more advanced functionality: two select elements,\nwhere selecting an option in the first one changes the options in the second.</p>\n<p>Open your <code>components/restaurant_list/restaurant_list.stache</code> and edit it as follows:</p>\n<pre><code>&lt;div class=&quot;restaurants&quot;&gt;\n  &lt;h2 class=&quot;page-header&quot;&gt;Restaurants&lt;/h2&gt;\n  &lt;form class=&quot;form&quot;&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n      &lt;label&gt;State&lt;/label&gt;\n      &lt;select {($value)}=&quot;state&quot;&gt;\n        {{^if state}}\n        &lt;option value=&quot;&quot;&gt;Choose a state&lt;/option&gt;\n        {{/if}}\n        {{#each states}}\n        &lt;option value=&quot;{{name}}&quot;&gt;{{name}}&lt;/option&gt;\n        {{/each}}\n      &lt;/select&gt;\n    &lt;/div&gt;\n    &lt;!-- The city select will go here --&gt;\n  &lt;/form&gt;\n\n  &lt;!-- Restaurants code will go here --&gt;\n&lt;/div&gt;\n</code></pre>\n<p>In the above code, you can see one select element for selecting a state. You can\nsee <code>{{#each}}</code> being used to create the list of options. You can also see that\nif no state is selected, the “Choose a state” message is included as an option\nuntil one has been selected.</p>\n<p>Let’s modify our <code>components/restaurant_list/restaurant_list.js</code> file to include\nwhat’s needed for our partial:</p>\n<pre><code>can.Component.extend({\n  tag: 'pmo-restaurant-list',\n  template: can.view('components/restaurant_list/restaurant_list.stache'),\n  viewModel: can.Map.extend({\n    define: {\n      state: {\n        value: null,\n        set: function(newState) {\n          if (newState) {\n            alert('Selected “' + newState + '” state.');\n          }\n          return newState;\n        }\n      },\n      states: {\n        value: [\n          {\n            cities: ['Green Bay', 'Milwaukee'],\n            name: 'Wisconsin'\n          },\n          {\n            cities: ['Detroit', 'Ann Arbor'],\n            name: 'Michigan'\n          },\n          {\n            cities: ['Chicago', 'Peoria'],\n            name: 'Illinois'\n          }\n        ]\n      },\n      // City code will go here\n    }\n  })\n});\n</code></pre>\n<p>Here we’re using <a href=\"TheDefinePlugin.html\">the define plugin</a> to set up two new\nproperties:</p>\n<ul>\n<li><code>state</code> to keep track of the selected state, and</li>\n<li><code>states</code> with the list of states that can be selected.</li>\n</ul>\n<p>In the <code>state</code> setter, we’re showing an alert when a new state is selected.\nIf you refresh the Restaurants page, you should see a select element with the\nstates as options; when you select a state, an alert will appear with the selected\nstate’s name.</p>\n<p><img src=\"../can/guides/images/view-models/view_model_state.png\" alt=\"set up state selector\" /></p>\n<h2>Getting and Setting Scope Properties</h2>\n<p>It’s important to understand how to get and set the properties\nof the view model. Getting and setting are done through the <code>attr</code> function off of\nthe <code>viewModel</code> object, in this case <code>this</code> is bound to the scope, because we’re\nwithin a method of the scope. Let’s look at an example.</p>\n<p>Open up <code>components/restaurant_list/restaurant_list.js</code> and replace this:</p>\n<pre><code>// City code will go here\n</code></pre>\n<p>with this:</p>\n<pre><code>      cities: {\n        get: function() {\n          var state = this.attr('state');\n          return state &amp;&amp; this.attr('citiesByState')[state];\n        }\n      },\n      citiesByState: {\n        get: function() {\n          var citiesByState = {};\n          this.attr('states').forEach(function(state) {\n            citiesByState[state.name] = state.cities;\n          });\n          return citiesByState;\n        }\n      },\n      city: {\n        value: null\n      }\n</code></pre>\n<p>This code creates three new properties:</p>\n<ul>\n<li><code>city</code> with the name of the city that’s selected,</li>\n<li><code>citiesByState</code> which is an object that has the list of cities by state name, and</li>\n<li><code>cities</code> which is the list of cities for the selected state.</li>\n</ul>\n<p>Let’s update the stache file to take advantage of these new properties.\nOpen <code>components/restaurant_list/restaurant_list.stache</code> and find this line:</p>\n<pre><code>&lt;!-- The city select will go here --&gt;\n</code></pre>\n<p>and replace it with this:</p>\n<pre><code>    &lt;div class=&quot;form-group&quot;&gt;\n      &lt;label&gt;City&lt;/label&gt;\n      &lt;select {($value)}=&quot;city&quot;&gt;\n        {{^if city}}\n        &lt;option value=&quot;&quot;&gt;Choose a city&lt;/option&gt;\n        {{/if}}\n        {{#each cities}}\n        &lt;option&gt;{{.}}&lt;/option&gt;\n        {{/each}}\n      &lt;/select&gt;\n    &lt;/div&gt;\n</code></pre>\n<p>This new part of the template will show a select element with the cities\nfor the selected state as options. Note that when no city is selected,\nthe element will have a “Choose a city” option.</p>\n<p>If you refresh the Restaurants page, you’ll see the new city select\nelement that has options as soon as you select a state. However, there’s\na bug: if you change the state, the first city for the new state is automatically\nselected, even though the user hasn’t made a city choice. Let’s fix this\nby nullifying the city when the state changes. Find the state setter:</p>\n<pre><code>        set: function(newState) {\n          if (newState) {\n            alert('Selected “' + newState + '” state.');\n          }\n          return newState;\n        }\n</code></pre>\n<p>and replace it with this:</p>\n<pre><code>        set: function() {\n          // Remove the city when the state changes\n          this.attr('city', null);\n        }\n</code></pre>\n<p>Notice that we are nullifying the city property when the state changes.\nIf you refresh the Restaurants page in your browser, select a state,\nselect a city, then select another state, you’ll see the “Choose a city”\noption in the city select element instead of the first city in that\nstate.</p>\n<p><img src=\"../can/guides/images/view-models/view_model_city.png\" alt=\"set up state selector\" /></p>\n<h2>Separating the Component &amp; View Model</h2>\n<p>It’s considered a best practice to keep your <code>can.Components</code>\nthin. This helps maintain readability and maintainability. To accomplish this,\nyou extract your scope from the <code>can.Component</code> into a <code>can.Map</code>.</p>\n<p>Open up <code>components/restaurant_list/restaurant_list.js</code> and replace the\ncontents of the file with this:</p>\n<pre><code>var RestaurantListViewModel = can.Map.extend({\n  define: {\n    state: {\n      value: null,\n      set: function() {\n        // Remove the city when the state changes\n        this.attr('city', null);\n      }\n    },\n    states: {\n      value: [\n        {\n          cities: ['Green Bay', 'Milwaukee'],\n          name: 'Wisconsin'\n        },\n        {\n          cities: ['Detroit', 'Ann Arbor'],\n          name: 'Michigan'\n        },\n        {\n          cities: ['Chicago', 'Peoria'],\n          name: 'Illinois'\n        }\n      ]\n    },\n    cities: {\n      get: function() {\n        var state = this.attr('state');\n        return state &amp;&amp; this.attr('citiesByState')[state];\n      }\n    },\n    citiesByState: {\n      get: function() {\n        var citiesByState = {};\n        this.attr('states').forEach(function(state) {\n          citiesByState[state.name] = state.cities;\n        });\n        return citiesByState;\n      }\n    },\n    city: {\n      value: null\n    }\n  }\n});\n\ncan.Component.extend({\n  tag: 'pmo-restaurant-list',\n  template: can.view('components/restaurant_list/restaurant_list.stache'),\n  viewModel: RestaurantListViewModel\n});\n</code></pre>\n<p>If you go back out to your application and refresh the page, it should all\nlook and work the same. What we’ve done, by separating out the view model,\nis make the code easier to read and maintain.</p>\n<p>In the next chapter, we’ll learn about working with more realistic data by\nadding REST service interaction with <code>can.Model</code>.</p>\n<hr />\n<p><span class=\"pull-left\"><a href=\"Components.html\">&lsaquo; Components</a></span>\n<span class=\"pull-right\"><a href=\"DataModelsAndFixtures.html\">Data Models and Fixtures &rsaquo;</a></span></p>\n</div>\n\n</section>\n\n    \t\t\n    \t\n\n    </article>\n  </div>\n</div>\n","src":{"path":"docs/can-guides/getting-started-tutorial/view-models.md"},"description":"\n","name":"ViewModels","title":"View Models","type":"page","parent":"Tutorial","order":8,"disabletableofcontents":true,"comment":" "};
	</script>

	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/bit-docs-site/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript'
				data-main="bit-docs-site/static"
				src="./static/node_modules/steal/steal.production.js"></script>
	
</body>

</html>
