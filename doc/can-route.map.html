<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE -- ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: [object Object]
	@function can-route.map
######################################################################## -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
	<link rel="stylesheet" type="text/css" href="./static/bundles/bit-docs-site/static.css">
	
</head>

<body>
  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger">Menu</label>
  <header><nav class="navbar">
	<a class="brand" href="../index.html">CanJS</a>

	<ul class="bitovi-menu">
		<li class="dropdown">
			<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
			<ul class="dropdown-menu">
				<li><a href="http://bitovi.com">Bitovi.com</a></li>
				<li><a href="http://bitovi.com/blog/">Blog</a></li>
				<li><a href="http://bitovi.com/consulting/">Consulting</a></li>
				<li><a href="http://bitovi.com/training/">Training</a></li>
				<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
			</ul>
		</li>
	</ul>

	<ul class="navbar-items">
		<li class="dropdown">
				<a href="http://github.com/canjs/canjs">Github</a>
				<ul class="dropdown-menu">
      		<li><a href="http://github.com/canjs/can-connect">can-connect</a></li>
					<li><a href=".">can-set</a></li>
					<li><a href=".">can-compute</a></li>
					<li><a href=".">can-component</a></li>
				</ul>
		</li>
		<li>
			<a href="https://gitter.im/canjs/canjs">Chat</a>
		</li>
		<li>
			<a href="http://forums.donejs.com/c/canjs">Forum</a>
		</li>
	</ul>

</nav>
</header>
  	<div class="main-container">
  
  	<nav class="sidebar">
    
        
	<ul>
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="page"
							href="can-core.html">
							Core
						</a>
						
							
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-component.html">
							can-component
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-compute.html">
							can-compute
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-connect.html">
							can-connect
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-construct.html">
							can-construct
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-define.html">
							can-define
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-define/list/list.html">
							can-define/list/list
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-define/map/map.html">
							can-define/map/map
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="function"
							href="can-route.html">
							can-route
						</a>
						
							
	<ul>
		
			
				
					<li>
						<span>static</span>

						
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="function"
							href="can-route.deparam.html">
							deparam
						</a>
						
					</li>
				

			
		
			
				
					<li class="current
                               parent
                               expanded">
						<a class="function"
							href="can-route.map.html">
							map
						</a>
						
							

						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="function"
							href="can-route.ready.html">
							ready
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="function"
							href="can-route.url.html">
							url
						</a>
						
					</li>
				

			
		
	</ul>


					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-route-pushstate.html">
							can-route-pushstate
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-set.html">
							can-set
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-stache.html">
							can-stache
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="module"
							href="can-stache-bindings.html">
							can-stache-bindings
						</a>
						
					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-ecosystem.html">
							Ecosystem
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-infrastructure.html">
							Infrastructure
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-legacy.html">
							Legacy
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="guides.html">
							Guides
						</a>
						
					</li>
				

			
		
	</ul>


    
</nav>
  

  <div class="content-container">
    <article>
    	
    		<section class="title">
	<h1>map</h1>
</section>

    	

        

    	
    		
    			<section class="description">
    <p>Assign a can-map instance that acts as can-route's internal can-map.  The purpose for this is to cross-bind a top level state object (Application State) to the can-route.</p>

</section>

    		
    	

    
    
    
    <div class="signature">
  <h2 class="signature-title"><code>route.map(MapConstructor)</code></h2>
  <p>Binds can-route to an instance based on a constructor. A new instance will be created and bound to:</p>
<pre><code class="language-js">var ViewModel = Map.attr({
    define: {
        page: {
            set: function(page){
                if(page === &quot;user&quot;) {
                    this.verifyLoggedIn();
                }
                return page;
            }
        }
    }
});

route.map(ViewModel);
</code></pre>

  
  
  <div class="parameters">
    <h3 class="parameters-title">Parameters</h3>
      <ol>
        
          <li><b>MapConstructor</b> <code>{<a href="can-map.html" >can-map</a>}</code>: <p>A can-map constructor function.  A new can-map instance will be created and used as the can-map internal to can-route.</p>
</li>
        
      </ol>
  </div>
  
  
  
  
  
</div>
    
    <div class="signature">
  <h2 class="signature-title"><code>route.map(mapInstance)</code></h2>
  <p>Bind can-route to an instance of a map.</p>
<pre><code class="language-js">var map = new Map({
    page: &quot;home&quot;
});

route.map(map);

map.attr(&quot;page&quot;, &quot;user&quot;);
// location.hash -&gt; &quot;#user&quot;
</code></pre>

  
  
  <div class="parameters">
    <h3 class="parameters-title">Parameters</h3>
      <ol>
        
          <li><b>mapInstance</b> <code>{<a href="can-map.html" >can-map</a>}</code>: <p>A can-map instance, used as the can-map internal to can-route.</p>
</li>
        
      </ol>
  </div>
  
  
  
  
  
</div>
    
    
    


    	
    		
    			<section class="body">
    <h2>Background</h2>
<p>One of the biggest challenges in a complex application is getting all the different parts of the app to talk to each other simply, cleanly, and reliably.</p>
<p>An elegant way to solve this problem is using the <a href="http://en.wikipedia.org/wiki/Observer_pattern">Observer Pattern</a>. A single object, which can be called <a href="https://www.youtube.com/watch?v=LrzK4exG5Ss">Application State</a>, holds the high level state of the application.</p>
<h2>Use</h2>
<p><code>route.map</code> provides an easy to way make your Application State object cross-bound to <code>route</code>, using an internal can-map instance, which is serialized into the hash (or pushstate URLs).</p>
<pre><code class="language-js">var appState = new Map({
    petType: &quot;dog&quot;,
    storeId: 2
});

route.map(appState);
</code></pre>
<h2>When to call it</h2>
<p>Call <code>route.map</code> at the  start of the application lifecycle, before any calls to <code>route.bind</code>. This is because <code>route.map</code> creates a new internal <code>Map</code>, replacing the default <code>can.Map</code> instance, so binding has to occur on this new object.</p>
<pre><code class="language-js">var appState = new Map({
    graphType: &quot;line&quot;,
    currencyType: &quot;USD&quot;
});

route.map(appState);
</code></pre>
<h2>Demo</h2>
<p>The following shows creating an appState that loads data at page load, has a virtual property 'locationIds' which serializes an array, and synchronizes the appState to can-route:</p>
<div class='demo_wrapper' data-demo-src='demos/can-route/map.html'></div>
<h2>Using arrays and can.Lists</h2>
<p>If the Application State contains a property which is any non-primitive type, its useful to use the [can-map.prototype.define define] plugin to define how that property will serialize. <code>route</code> calls [can.Map.prototype.serialize serialize] internally to turn the Application State object into URL params.</p>
<p>The following example shows a flags property, which is an array of string-based flags:</p>
<pre><code class="language-js">var AppState = Map.extend({
    define: {
        flags: {
        // return a string friendly format
        serialize: function(){
        return this.attr('flags').join(',');
        },
        // convert a stringified object into an array
        set: function(val){
        if(val === &quot;&quot;){
            return [];
        }
        var arr = val;
        if(typeof val === &quot;string&quot;){
            arr = val.split(',')
        }
        return arr;
    }
    }
});

var appState = new AppState({
    flags: []
});

route.map(appState);
</code></pre>
<h2>Complete example</h2>
<p>The following example shows loading some metadata on page load, which must be loaded as part of the Application State before the components can be initialized</p>
<p>It also shows an example of a &quot;virtual&quot; property on the AppState, locationIds, which is the serialized version of a non-serializeable can.List, locations.  A setter is defined on locationIds, which will translate changes in locationIds back to the locations can.List.</p>
<pre><code class="language-js">var AppState = Map.extend({
    define: {
        locations: {
            // don't serialize this property at all in the route
            serialize: false
        },
        // virtual property that contains a comma separated list of ids
        // based on locations that are selected
        locationIds: {

            // comma separated list of ids
            serialize: function(){
                var selected = this.attr('locations').filter(
                    function(location){
                        return location.attr('selected');
                    });
                var ids = [];
                selected.each(function(item){
                    ids.push(item.attr('id'));
                })
                return selected.join(',');
            },
            
            // toggle selected from a comma separated list of ids
            set: function(val){
                var arr = val;
                if(typeof val === &quot;string&quot;){
                    arr = val.split(',')
                }
                // for each id, toggle any matched location
                this.attr('locations').each(function(location){
                    if(arr.indexOf(location.attr('id')) !== -1){
                        location.attr('selected', true);
                    } else {
                        location.attr('selected', false)
                    }
                })
            }
        }
    }
});

// initialize and call map first, so anything binding to can-route
// will work correctly
var appState = new AppState();
route.map(appState);

// GET /locations
var locations = new Location.List({});

// when the data is ready, set the locations property
locations.done(function(){
    var appState.attr('locations', locations)

    // call ready after the appState is fully initialized
    route.ready();
});
</code></pre>
<h2>Why</h2>
<p>The Application State object, which is cross-bound to the can-route via <code>route.map</code> and represents the overall state of the application, has several obvious uses:</p>
<ul>
<li>It is passed into the various components and used to communicate their own internal state.</li>
<li>It provides deep linking and back button support. As the URL changes, Application State changes cause changes in application components.</li>
<li>It provides the ability to &quot;save&quot; the current state of the page, by serializing the Application State object and saving it on the backend, then restoring with that object to load this saved state.</li>
</ul>

</section>

    		
    	

    </article>
  </div>
</div>

  <footer><p>CanJS is part of <a href="http://donejs.com">DoneJS</a>. Created and maintained by the open source team at <a href="http://bitovi.com">Bitovi</a>. <strong>Currently v3.0.0.</strong></p></footer>
	<script type="text/javascript">
		var docObject = {"content":"<div class=\"main-container\">\n  \n  \t<nav class=\"sidebar\">\n    \n        \n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-core.html\">\n\t\t\t\t\t\t\tCore\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-component.html\">\n\t\t\t\t\t\t\tcan-component\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-compute.html\">\n\t\t\t\t\t\t\tcan-compute\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-connect.html\">\n\t\t\t\t\t\t\tcan-connect\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-construct.html\">\n\t\t\t\t\t\t\tcan-construct\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-define.html\">\n\t\t\t\t\t\t\tcan-define\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-define/list/list.html\">\n\t\t\t\t\t\t\tcan-define/list/list\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-define/map/map.html\">\n\t\t\t\t\t\t\tcan-define/map/map\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"function\"\n\t\t\t\t\t\t\thref=\"can-route.html\">\n\t\t\t\t\t\t\tcan-route\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<span>static</span>\n\n\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"function\"\n\t\t\t\t\t\t\thref=\"can-route.deparam.html\">\n\t\t\t\t\t\t\tdeparam\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"current\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"function\"\n\t\t\t\t\t\t\thref=\"can-route.map.html\">\n\t\t\t\t\t\t\tmap\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"function\"\n\t\t\t\t\t\t\thref=\"can-route.ready.html\">\n\t\t\t\t\t\t\tready\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"function\"\n\t\t\t\t\t\t\thref=\"can-route.url.html\">\n\t\t\t\t\t\t\turl\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-route-pushstate.html\">\n\t\t\t\t\t\t\tcan-route-pushstate\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-set.html\">\n\t\t\t\t\t\t\tcan-set\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-stache.html\">\n\t\t\t\t\t\t\tcan-stache\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"module\"\n\t\t\t\t\t\t\thref=\"can-stache-bindings.html\">\n\t\t\t\t\t\t\tcan-stache-bindings\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-ecosystem.html\">\n\t\t\t\t\t\t\tEcosystem\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-infrastructure.html\">\n\t\t\t\t\t\t\tInfrastructure\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-legacy.html\">\n\t\t\t\t\t\t\tLegacy\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"guides.html\">\n\t\t\t\t\t\t\tGuides\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n    \n</nav>\n  \n\n  <div class=\"content-container\">\n    <article>\n    \t\n    \t\t<section class=\"title\">\n\t<h1>map</h1>\n</section>\n\n    \t\n\n        \n\n    \t\n    \t\t\n    \t\t\t<section class=\"description\">\n    <p>Assign a can-map instance that acts as can-route's internal can-map.  The purpose for this is to cross-bind a top level state object (Application State) to the can-route.</p>\n\n</section>\n\n    \t\t\n    \t\n\n    \n    \n    \n    <div class=\"signature\">\n  <h2 class=\"signature-title\"><code>route.map(MapConstructor)</code></h2>\n  <p>Binds can-route to an instance based on a constructor. A new instance will be created and bound to:</p>\n<pre><code class=\"language-js\">var ViewModel = Map.attr({\n    define: {\n        page: {\n            set: function(page){\n                if(page === &quot;user&quot;) {\n                    this.verifyLoggedIn();\n                }\n                return page;\n            }\n        }\n    }\n});\n\nroute.map(ViewModel);\n</code></pre>\n\n  \n  \n  <div class=\"parameters\">\n    <h3 class=\"parameters-title\">Parameters</h3>\n      <ol>\n        \n          <li><b>MapConstructor</b> <code>{<a href=\"can-map.html\" >can-map</a>}</code>: <p>A can-map constructor function.  A new can-map instance will be created and used as the can-map internal to can-route.</p>\n</li>\n        \n      </ol>\n  </div>\n  \n  \n  \n  \n  \n</div>\n    \n    <div class=\"signature\">\n  <h2 class=\"signature-title\"><code>route.map(mapInstance)</code></h2>\n  <p>Bind can-route to an instance of a map.</p>\n<pre><code class=\"language-js\">var map = new Map({\n    page: &quot;home&quot;\n});\n\nroute.map(map);\n\nmap.attr(&quot;page&quot;, &quot;user&quot;);\n// location.hash -&gt; &quot;#user&quot;\n</code></pre>\n\n  \n  \n  <div class=\"parameters\">\n    <h3 class=\"parameters-title\">Parameters</h3>\n      <ol>\n        \n          <li><b>mapInstance</b> <code>{<a href=\"can-map.html\" >can-map</a>}</code>: <p>A can-map instance, used as the can-map internal to can-route.</p>\n</li>\n        \n      </ol>\n  </div>\n  \n  \n  \n  \n  \n</div>\n    \n    \n    \n\n\n    \t\n    \t\t\n    \t\t\t<section class=\"body\">\n    <h2>Background</h2>\n<p>One of the biggest challenges in a complex application is getting all the different parts of the app to talk to each other simply, cleanly, and reliably.</p>\n<p>An elegant way to solve this problem is using the <a href=\"http://en.wikipedia.org/wiki/Observer_pattern\">Observer Pattern</a>. A single object, which can be called <a href=\"https://www.youtube.com/watch?v=LrzK4exG5Ss\">Application State</a>, holds the high level state of the application.</p>\n<h2>Use</h2>\n<p><code>route.map</code> provides an easy to way make your Application State object cross-bound to <code>route</code>, using an internal can-map instance, which is serialized into the hash (or pushstate URLs).</p>\n<pre><code class=\"language-js\">var appState = new Map({\n    petType: &quot;dog&quot;,\n    storeId: 2\n});\n\nroute.map(appState);\n</code></pre>\n<h2>When to call it</h2>\n<p>Call <code>route.map</code> at the  start of the application lifecycle, before any calls to <code>route.bind</code>. This is because <code>route.map</code> creates a new internal <code>Map</code>, replacing the default <code>can.Map</code> instance, so binding has to occur on this new object.</p>\n<pre><code class=\"language-js\">var appState = new Map({\n    graphType: &quot;line&quot;,\n    currencyType: &quot;USD&quot;\n});\n\nroute.map(appState);\n</code></pre>\n<h2>Demo</h2>\n<p>The following shows creating an appState that loads data at page load, has a virtual property 'locationIds' which serializes an array, and synchronizes the appState to can-route:</p>\n<div class='demo_wrapper' data-demo-src='demos/can-route/map.html'></div>\n<h2>Using arrays and can.Lists</h2>\n<p>If the Application State contains a property which is any non-primitive type, its useful to use the [can-map.prototype.define define] plugin to define how that property will serialize. <code>route</code> calls [can.Map.prototype.serialize serialize] internally to turn the Application State object into URL params.</p>\n<p>The following example shows a flags property, which is an array of string-based flags:</p>\n<pre><code class=\"language-js\">var AppState = Map.extend({\n    define: {\n        flags: {\n        // return a string friendly format\n        serialize: function(){\n        return this.attr('flags').join(',');\n        },\n        // convert a stringified object into an array\n        set: function(val){\n        if(val === &quot;&quot;){\n            return [];\n        }\n        var arr = val;\n        if(typeof val === &quot;string&quot;){\n            arr = val.split(',')\n        }\n        return arr;\n    }\n    }\n});\n\nvar appState = new AppState({\n    flags: []\n});\n\nroute.map(appState);\n</code></pre>\n<h2>Complete example</h2>\n<p>The following example shows loading some metadata on page load, which must be loaded as part of the Application State before the components can be initialized</p>\n<p>It also shows an example of a &quot;virtual&quot; property on the AppState, locationIds, which is the serialized version of a non-serializeable can.List, locations.  A setter is defined on locationIds, which will translate changes in locationIds back to the locations can.List.</p>\n<pre><code class=\"language-js\">var AppState = Map.extend({\n    define: {\n        locations: {\n            // don't serialize this property at all in the route\n            serialize: false\n        },\n        // virtual property that contains a comma separated list of ids\n        // based on locations that are selected\n        locationIds: {\n\n            // comma separated list of ids\n            serialize: function(){\n                var selected = this.attr('locations').filter(\n                    function(location){\n                        return location.attr('selected');\n                    });\n                var ids = [];\n                selected.each(function(item){\n                    ids.push(item.attr('id'));\n                })\n                return selected.join(',');\n            },\n            \n            // toggle selected from a comma separated list of ids\n            set: function(val){\n                var arr = val;\n                if(typeof val === &quot;string&quot;){\n                    arr = val.split(',')\n                }\n                // for each id, toggle any matched location\n                this.attr('locations').each(function(location){\n                    if(arr.indexOf(location.attr('id')) !== -1){\n                        location.attr('selected', true);\n                    } else {\n                        location.attr('selected', false)\n                    }\n                })\n            }\n        }\n    }\n});\n\n// initialize and call map first, so anything binding to can-route\n// will work correctly\nvar appState = new AppState();\nroute.map(appState);\n\n// GET /locations\nvar locations = new Location.List({});\n\n// when the data is ready, set the locations property\nlocations.done(function(){\n    var appState.attr('locations', locations)\n\n    // call ready after the appState is fully initialized\n    route.ready();\n});\n</code></pre>\n<h2>Why</h2>\n<p>The Application State object, which is cross-bound to the can-route via <code>route.map</code> and represents the overall state of the application, has several obvious uses:</p>\n<ul>\n<li>It is passed into the various components and used to communicate their own internal state.</li>\n<li>It provides deep linking and back button support. As the URL changes, Application State changes cause changes in application components.</li>\n<li>It provides the ability to &quot;save&quot; the current state of the page, by serializing the Application State object and saving it on the backend, then restoring with that object to load this saved state.</li>\n</ul>\n\n</section>\n\n    \t\t\n    \t\n\n    </article>\n  </div>\n</div>\n","src":{"path":"node_modules/can-route/route_map.md"},"description":"\nAssign a can-map instance that acts as can-route's internal can-map.  The purpose for this is to cross-bind a top level state object (Application State) to the can-route.\n","title":"map","name":"can-route.map","type":"function","parent":"can-route.static","signatures":[{"code":"route.map(MapConstructor)","description":"\n\nBinds can-route to an instance based on a constructor. A new instance will be created and bound to:\n\n```js\nvar ViewModel = Map.attr({\n\tdefine: {\n\t\tpage: {\n\t\t\tset: function(page){\n\t\t\t\tif(page === \"user\") {\n\t\t\t\t\tthis.verifyLoggedIn();\n\t\t\t\t}\n\t\t\t\treturn page;\n\t\t\t}\n\t\t}\n\t}\n});\n\nroute.map(ViewModel);\n```\n","params":[{"types":[{"type":"can-map"}],"name":"MapConstructor","description":"A can-map constructor function.  A new can-map instance will be created and used as the can-map internal to can-route.\n"}]},{"code":"route.map(mapInstance)","description":"\n\nBind can-route to an instance of a map.\n\n```js\nvar map = new Map({\n\tpage: \"home\"\n});\n\nroute.map(map);\n\nmap.attr(\"page\", \"user\");\n// location.hash -> \"#user\"\n```\n","params":[{"types":[{"type":"can-map"}],"name":"mapInstance","description":"A can-map instance, used as the can-map internal to can-route.\n"}]}],"_curParam":{"types":[{"type":"can-map"}],"name":"mapInstance","description":"A can-map instance, used as the can-map internal to can-route.\n"},"comment":" "};
	</script>

	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/bit-docs-site/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript'
				data-main="bit-docs-site/static"
				src="./static/node_modules/steal/steal.production.js"></script>
	
</body>

</html>
