<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE -- ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: [object Object]
	@page AppStateAndRouting
######################################################################## -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
	<link rel="stylesheet" type="text/css" href="./static/bundles/bit-docs-site/static.css">
	
</head>

<body>
  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger">Menu</label>
  <header><nav class="navbar">
	<a class="brand" href="../index.html">CanJS</a>

	<ul class="bitovi-menu">
		<li class="dropdown">
			<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
			<ul class="dropdown-menu">
				<li><a href="http://bitovi.com">Bitovi.com</a></li>
				<li><a href="http://bitovi.com/blog/">Blog</a></li>
				<li><a href="http://bitovi.com/consulting/">Consulting</a></li>
				<li><a href="http://bitovi.com/training/">Training</a></li>
				<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
			</ul>
		</li>
	</ul>

	<ul class="navbar-items">
		<li class="dropdown">
				<a href="http://github.com/canjs/canjs">Github</a>
				<ul class="dropdown-menu">
      		<li><a href="http://github.com/canjs/can-connect">can-connect</a></li>
					<li><a href=".">can-set</a></li>
					<li><a href=".">can-compute</a></li>
					<li><a href=".">can-component</a></li>
				</ul>
		</li>
		<li>
			<a href="https://gitter.im/canjs/canjs">Chat</a>
		</li>
		<li>
			<a href="http://forums.donejs.com/c/canjs">Forum</a>
		</li>
	</ul>

</nav>
</header>
  	<div class="main-container">
  
  	<nav class="sidebar">
    
        
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-core.html">
							Core
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-ecosystem.html">
							Ecosystem
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-infrastructure.html">
							Infrastructure
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-legacy.html">
							Legacy
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="page"
							href="guides.html">
							Guides
						</a>
						
							
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Why.html">
							Why CanJS?
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Using.html">
							Setting up CanJS
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="page"
							href="Tutorial.html">
							Getting Started Tutorial
						</a>
						
							
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Setup.html">
							Setup
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="ApplicationDesign.html">
							Application Design
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Constructors.html">
							Constructors
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Observables.html">
							Observables
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="TheDefinePlugin.html">
							The Define Plugin
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="StacheTemplates.html">
							Stache Templates
						</a>
						
					</li>
				

			
		
			
				
					<li class="current
                               parent
                               expanded">
						<a class="page"
							href="AppStateAndRouting.html">
							App State and Routing
						</a>
						
							

						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Components.html">
							Components
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="ViewModels.html">
							View Models
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="DataModelsAndFixtures.html">
							Data Models and Fixtures
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Routing.html">
							Routing
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="LoadingStates.html">
							Loading States
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="EventHandling.html">
							Event Handling
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="WebServiceCommunication.html">
							Web Service Communication
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Recap.html">
							Recap
						</a>
						
					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Recipes.html">
							Recipes
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="migrating.html">
							Migrating to 3.0
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="roadmap.html">
							Roadmap
						</a>
						
					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
	</ul>


    
</nav>
  

  <div class="content-container">
    <article>
    	
    		<section class="title">
	<h1>App State and Routing</h1>
</section>

    	

        

    	
    		
    			<section class="description">
    
</section>

    		
    	

    
    
    
    
    


    	
    		
    			<section class="body">
    <div class="getting-started">
<hr />
<p><strong>In this Chapter</strong></p>
<ul>
<li>AppState</li>
<li>Basic Routing</li>
<li>Binding the AppState Object to the Application and Routes</li>
</ul>
<p>Get the code for: <a href="/guides/examples/PlaceMyOrder/ch-3_canjs-getting-started.zip">chapter: app state and routing</a></p>
<hr />
<p>As mentioned in the <a href="Tutorial.html">introduction</a>, CanJS suggests using a global
<code>appState</code> object to manage the state of your application. The <code>appState</code> object
is bound to two things:</p>
<ol>
<li>The application’s base template</li>
<li>The application’s routing</li>
</ol>
<p>Since you already know about creating instances of <code>can.Map</code>, creating an
<code>appState</code> object, which is a <code>can.Map</code>, will be easy. Let’s see how this works.
Open up your <code>app.js</code> file and update it as shown below.</p>
<pre><code>$(function () {
    var AppState = can.Map.extend({});

    var appState = new AppState();

    // Bind the application state to the root of the application
    $('#can-main').html(can.view('main.stache', appState));

    // Set up the routes
    can.route(':page', { page: 'home' });
    can.route(':page/:slug', { slug: null });
    can.route(':page/:slug/:action', { slug: null, action: null });

    $('body').on('click', 'a[href=&quot;javascript://&quot;]', function(ev) {
        ev.preventDefault();
    });

    // Bind the application state to the can.route
    can.route.map(appState);

    can.route.ready();

    //appState.attr('page', 'restaurants');

    appState.bind('change', function(ev, prop, change, newVal, oldVal) {
        alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');
    });
});
</code></pre>
<h2>Routing</h2>
<p>Before we dive into the details of the <code>appState</code> object, let’s quickly discuss
routing. Routing in CanJS allows us to manage browser history and client state by
synchronizing the <code>window.location.hash</code> with a <code>can.Map</code>. In other words, we can
use routing to reflect the state of our application or set the state of our application.
One of the things that makes routing powerful is that it records the state of the
application in the browser’s history. We’ll see some specific examples of this
as we proceed.</p>
<p>In our application, we setup routing by:</p>
<ul>
<li>defining the possible routes by calling <code>can.route</code>,</li>
<li>binding our <code>appState</code> object to the route with a call to <code>can.route.map</code>, and</li>
<li>calling <code>can.route.ready()</code>, which sets up two-way binding between the
browser’s <code>window.location.hash</code> and the <code>can.route</code>’s internal <code>can.Map</code>.</li>
</ul>
<p>On lines 10–12, we define all the potential routes in our application and the
properties on the <code>appState</code> object. Let’s look at each line individually.</p>
<pre><code>can.route(':page', { page: 'home' });
</code></pre>
<p>This line does two things:</p>
<ol>
<li>Creates a base route that is bound to one property: <code>page</code>.</li>
<li>Sets the default value of the <code>page</code> property to <code>'home'</code>.</li>
</ol>
<p>In our app, this will allow the following URLs:</p>
<ul>
<li><code>#!</code> (which will set <code>page</code> to <code>'home'</code> because that’s the default)</li>
<li><code>#!orders/</code> (which will set <code>page</code> to <code>'orders'</code>)</li>
<li><code>#!restaurants/</code> (which will set <code>page</code> to <code>'restaurants'</code>)</li>
</ul>
<pre><code>can.route(':page/:slug', { slug: null });
</code></pre>
<p>This line does two things:</p>
<ol>
<li>Binds a new <code>slug</code> property to our <code>appState</code> object.</li>
<li>Sets the default value of the <code>slug</code> property to <code>null</code>.</li>
</ol>
<p>This makes the following URLs possible:</p>
<ul>
<li><code>#!restaurants/spago/</code> (<code>page</code> will be <code>'restaurants'</code> and <code>slug</code> will be <code>'spago'</code>)</li>
</ul>
<p>Anything in the second part of the URL will be the <code>slug</code> property on our
<code>appState</code> object.</p>
<pre><code>can.route(':page/:slug/:action', { slug: null, action: null });
</code></pre>
<p>This line does two things:</p>
<ol>
<li>Binds a new <code>action</code> property to our <code>appState</code> object.</li>
<li>Sets the default value of the <code>action</code> property to <code>null</code>.</li>
</ol>
<p>This makes the following URLs possible:</p>
<ul>
<li><code>#!restaurants/spago/order/</code> for order confirmation; again, <code>action</code> will be <code>'order'</code></li>
</ul>
<p>Let’s take a moment to see how these routes are bound to our <code>appState</code> object.
Notice the <code>//appState.attr('page', 'restaurants');</code> line at the end of our
<code>app.js</code> file; let’s uncomment that line so it looks like
<code>appState.attr('page', 'restaurants');</code></p>
<p>Now, refresh the app in your browser. The path will now be <code>#!restaurants</code>,
and you’ll notice that the Restaurants link in the navigation is highlighted.</p>
<p><img src="../can/guides/images/app-state-routing/app_state_route_rest.png" alt="place-my-order.com home page" /></p>
<p>Note that, after we initialized our routes, updating the value of our
<code>appState</code>’s <code>page</code> property caused the route to update as well.
The value of the <code>page</code> property was serialized and appended
to the <code>window.location.hash</code>.</p>
<p>Let’s see what happens if we adjust the value of the hash. To monitor this
change, we’ve included the following lines:</p>
<pre><code>appState.bind('change', function(ev, prop, change, newVal, oldVal) {
    alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');
});
</code></pre>
<p>These lines use <a href="../docs/can.Map.prototype.bind.html"><code>can.Map.bind</code></a> to
watch for changes to the <code>appState</code> object. Go ahead and change the URL from
<code>#!restaurants</code> to <code>#!orders</code>. You should see an alert with this message:</p>
<p><img src="../can/guides/images/app-state-routing/change_state_alert.png" alt="place-my-order.com home page" /></p>
<p>It was mentioned earlier that we bound our AppState to the application’s <code>main.stache</code>.
This is the key to connecting the AppState to our <a href="Components.html">components</a>.
Because the <code>appState</code> object is bound to our main template, which includes the rest of
the components in the app, <em>these attributes will automatically be included in the scope of
the components</em>.</p>
<p>Before moving on, let’s remove the following lines from our application:</p>
<pre><code>appState.attr('page', 'restaurants');

appState.bind('change', function(ev, prop, change, newVal, oldVal) {
    alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');
});
</code></pre>
<hr />
<p><span class="pull-left"><a href="StacheTemplates.html">&lsaquo; Stache Templates</a></span>
<span class="pull-right"><a href="Components.html">Components &rsaquo;</a></span></p>
</div>

</section>

    		
    	

    </article>
  </div>
</div>

  <footer><p>CanJS is part of <a href="http://donejs.com">DoneJS</a>. Created and maintained by the open source team at <a href="http://bitovi.com">Bitovi</a>. <strong>Currently v3.0.0.</strong></p></footer>
	<script type="text/javascript">
		var docObject = {"content":"<div class=\"main-container\">\n  \n  \t<nav class=\"sidebar\">\n    \n        \n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-core.html\">\n\t\t\t\t\t\t\tCore\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-ecosystem.html\">\n\t\t\t\t\t\t\tEcosystem\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-infrastructure.html\">\n\t\t\t\t\t\t\tInfrastructure\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-legacy.html\">\n\t\t\t\t\t\t\tLegacy\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"guides.html\">\n\t\t\t\t\t\t\tGuides\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Why.html\">\n\t\t\t\t\t\t\tWhy CanJS?\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Using.html\">\n\t\t\t\t\t\t\tSetting up CanJS\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Tutorial.html\">\n\t\t\t\t\t\t\tGetting Started Tutorial\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Setup.html\">\n\t\t\t\t\t\t\tSetup\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"ApplicationDesign.html\">\n\t\t\t\t\t\t\tApplication Design\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Constructors.html\">\n\t\t\t\t\t\t\tConstructors\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Observables.html\">\n\t\t\t\t\t\t\tObservables\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"TheDefinePlugin.html\">\n\t\t\t\t\t\t\tThe Define Plugin\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"StacheTemplates.html\">\n\t\t\t\t\t\t\tStache Templates\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"current\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"AppStateAndRouting.html\">\n\t\t\t\t\t\t\tApp State and Routing\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Components.html\">\n\t\t\t\t\t\t\tComponents\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"ViewModels.html\">\n\t\t\t\t\t\t\tView Models\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"DataModelsAndFixtures.html\">\n\t\t\t\t\t\t\tData Models and Fixtures\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Routing.html\">\n\t\t\t\t\t\t\tRouting\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"LoadingStates.html\">\n\t\t\t\t\t\t\tLoading States\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"EventHandling.html\">\n\t\t\t\t\t\t\tEvent Handling\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"WebServiceCommunication.html\">\n\t\t\t\t\t\t\tWeb Service Communication\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Recap.html\">\n\t\t\t\t\t\t\tRecap\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Recipes.html\">\n\t\t\t\t\t\t\tRecipes\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"migrating.html\">\n\t\t\t\t\t\t\tMigrating to 3.0\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"roadmap.html\">\n\t\t\t\t\t\t\tRoadmap\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n    \n</nav>\n  \n\n  <div class=\"content-container\">\n    <article>\n    \t\n    \t\t<section class=\"title\">\n\t<h1>App State and Routing</h1>\n</section>\n\n    \t\n\n        \n\n    \t\n    \t\t\n    \t\t\t<section class=\"description\">\n    \n</section>\n\n    \t\t\n    \t\n\n    \n    \n    \n    \n    \n\n\n    \t\n    \t\t\n    \t\t\t<section class=\"body\">\n    <div class=\"getting-started\">\n<hr />\n<p><strong>In this Chapter</strong></p>\n<ul>\n<li>AppState</li>\n<li>Basic Routing</li>\n<li>Binding the AppState Object to the Application and Routes</li>\n</ul>\n<p>Get the code for: <a href=\"/guides/examples/PlaceMyOrder/ch-3_canjs-getting-started.zip\">chapter: app state and routing</a></p>\n<hr />\n<p>As mentioned in the <a href=\"Tutorial.html\">introduction</a>, CanJS suggests using a global\n<code>appState</code> object to manage the state of your application. The <code>appState</code> object\nis bound to two things:</p>\n<ol>\n<li>The application’s base template</li>\n<li>The application’s routing</li>\n</ol>\n<p>Since you already know about creating instances of <code>can.Map</code>, creating an\n<code>appState</code> object, which is a <code>can.Map</code>, will be easy. Let’s see how this works.\nOpen up your <code>app.js</code> file and update it as shown below.</p>\n<pre><code>$(function () {\n    var AppState = can.Map.extend({});\n\n    var appState = new AppState();\n\n    // Bind the application state to the root of the application\n    $('#can-main').html(can.view('main.stache', appState));\n\n    // Set up the routes\n    can.route(':page', { page: 'home' });\n    can.route(':page/:slug', { slug: null });\n    can.route(':page/:slug/:action', { slug: null, action: null });\n\n    $('body').on('click', 'a[href=&quot;javascript://&quot;]', function(ev) {\n        ev.preventDefault();\n    });\n\n    // Bind the application state to the can.route\n    can.route.map(appState);\n\n    can.route.ready();\n\n    //appState.attr('page', 'restaurants');\n\n    appState.bind('change', function(ev, prop, change, newVal, oldVal) {\n        alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');\n    });\n});\n</code></pre>\n<h2>Routing</h2>\n<p>Before we dive into the details of the <code>appState</code> object, let’s quickly discuss\nrouting. Routing in CanJS allows us to manage browser history and client state by\nsynchronizing the <code>window.location.hash</code> with a <code>can.Map</code>. In other words, we can\nuse routing to reflect the state of our application or set the state of our application.\nOne of the things that makes routing powerful is that it records the state of the\napplication in the browser’s history. We’ll see some specific examples of this\nas we proceed.</p>\n<p>In our application, we setup routing by:</p>\n<ul>\n<li>defining the possible routes by calling <code>can.route</code>,</li>\n<li>binding our <code>appState</code> object to the route with a call to <code>can.route.map</code>, and</li>\n<li>calling <code>can.route.ready()</code>, which sets up two-way binding between the\nbrowser’s <code>window.location.hash</code> and the <code>can.route</code>’s internal <code>can.Map</code>.</li>\n</ul>\n<p>On lines 10–12, we define all the potential routes in our application and the\nproperties on the <code>appState</code> object. Let’s look at each line individually.</p>\n<pre><code>can.route(':page', { page: 'home' });\n</code></pre>\n<p>This line does two things:</p>\n<ol>\n<li>Creates a base route that is bound to one property: <code>page</code>.</li>\n<li>Sets the default value of the <code>page</code> property to <code>'home'</code>.</li>\n</ol>\n<p>In our app, this will allow the following URLs:</p>\n<ul>\n<li><code>#!</code> (which will set <code>page</code> to <code>'home'</code> because that’s the default)</li>\n<li><code>#!orders/</code> (which will set <code>page</code> to <code>'orders'</code>)</li>\n<li><code>#!restaurants/</code> (which will set <code>page</code> to <code>'restaurants'</code>)</li>\n</ul>\n<pre><code>can.route(':page/:slug', { slug: null });\n</code></pre>\n<p>This line does two things:</p>\n<ol>\n<li>Binds a new <code>slug</code> property to our <code>appState</code> object.</li>\n<li>Sets the default value of the <code>slug</code> property to <code>null</code>.</li>\n</ol>\n<p>This makes the following URLs possible:</p>\n<ul>\n<li><code>#!restaurants/spago/</code> (<code>page</code> will be <code>'restaurants'</code> and <code>slug</code> will be <code>'spago'</code>)</li>\n</ul>\n<p>Anything in the second part of the URL will be the <code>slug</code> property on our\n<code>appState</code> object.</p>\n<pre><code>can.route(':page/:slug/:action', { slug: null, action: null });\n</code></pre>\n<p>This line does two things:</p>\n<ol>\n<li>Binds a new <code>action</code> property to our <code>appState</code> object.</li>\n<li>Sets the default value of the <code>action</code> property to <code>null</code>.</li>\n</ol>\n<p>This makes the following URLs possible:</p>\n<ul>\n<li><code>#!restaurants/spago/order/</code> for order confirmation; again, <code>action</code> will be <code>'order'</code></li>\n</ul>\n<p>Let’s take a moment to see how these routes are bound to our <code>appState</code> object.\nNotice the <code>//appState.attr('page', 'restaurants');</code> line at the end of our\n<code>app.js</code> file; let’s uncomment that line so it looks like\n<code>appState.attr('page', 'restaurants');</code></p>\n<p>Now, refresh the app in your browser. The path will now be <code>#!restaurants</code>,\nand you’ll notice that the Restaurants link in the navigation is highlighted.</p>\n<p><img src=\"../can/guides/images/app-state-routing/app_state_route_rest.png\" alt=\"place-my-order.com home page\" /></p>\n<p>Note that, after we initialized our routes, updating the value of our\n<code>appState</code>’s <code>page</code> property caused the route to update as well.\nThe value of the <code>page</code> property was serialized and appended\nto the <code>window.location.hash</code>.</p>\n<p>Let’s see what happens if we adjust the value of the hash. To monitor this\nchange, we’ve included the following lines:</p>\n<pre><code>appState.bind('change', function(ev, prop, change, newVal, oldVal) {\n    alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');\n});\n</code></pre>\n<p>These lines use <a href=\"../docs/can.Map.prototype.bind.html\"><code>can.Map.bind</code></a> to\nwatch for changes to the <code>appState</code> object. Go ahead and change the URL from\n<code>#!restaurants</code> to <code>#!orders</code>. You should see an alert with this message:</p>\n<p><img src=\"../can/guides/images/app-state-routing/change_state_alert.png\" alt=\"place-my-order.com home page\" /></p>\n<p>It was mentioned earlier that we bound our AppState to the application’s <code>main.stache</code>.\nThis is the key to connecting the AppState to our <a href=\"Components.html\">components</a>.\nBecause the <code>appState</code> object is bound to our main template, which includes the rest of\nthe components in the app, <em>these attributes will automatically be included in the scope of\nthe components</em>.</p>\n<p>Before moving on, let’s remove the following lines from our application:</p>\n<pre><code>appState.attr('page', 'restaurants');\n\nappState.bind('change', function(ev, prop, change, newVal, oldVal) {\n    alert('Changed the “' + prop + '” property from “' + oldVal + '” to “' + newVal + '”.');\n});\n</code></pre>\n<hr />\n<p><span class=\"pull-left\"><a href=\"StacheTemplates.html\">&lsaquo; Stache Templates</a></span>\n<span class=\"pull-right\"><a href=\"Components.html\">Components &rsaquo;</a></span></p>\n</div>\n\n</section>\n\n    \t\t\n    \t\n\n    </article>\n  </div>\n</div>\n","src":{"path":"docs/can-guides/getting-started-tutorial/app-state-and-routing.md"},"description":"\n","name":"AppStateAndRouting","title":"App State and Routing","type":"page","parent":"Tutorial","order":6,"disabletableofcontents":true,"comment":" "};
	</script>

	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/bit-docs-site/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript'
				data-main="bit-docs-site/static"
				src="./static/node_modules/steal/steal.production.js"></script>
	
</body>

</html>
