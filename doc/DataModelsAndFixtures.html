<!DOCTYPE html>
<!--####################################################################
	THIS IS A GENERATED FILE -- ANY CHANGES MADE WILL BE OVERWRITTEN

	INSTEAD CHANGE:
	source: [object Object]
	@page DataModelsAndFixtures
######################################################################## -->
<html lang="en">
<head>
	<meta charset="utf-8">
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	
	<link rel="stylesheet" type="text/css" href="./static/bundles/bit-docs-site/static.css">
	
</head>

<body>
  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger">Menu</label>
  <header><nav class="navbar">
	<a class="brand" href="../index.html">CanJS</a>

	<ul class="bitovi-menu">
		<li class="dropdown">
			<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
			<ul class="dropdown-menu">
				<li><a href="http://bitovi.com">Bitovi.com</a></li>
				<li><a href="http://bitovi.com/blog/">Blog</a></li>
				<li><a href="http://bitovi.com/consulting/">Consulting</a></li>
				<li><a href="http://bitovi.com/training/">Training</a></li>
				<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
			</ul>
		</li>
	</ul>

	<ul class="navbar-items">
		<li class="dropdown">
				<a href="http://github.com/canjs/canjs">Github</a>
				<ul class="dropdown-menu">
      		<li><a href="http://github.com/canjs/can-connect">can-connect</a></li>
					<li><a href=".">can-set</a></li>
					<li><a href=".">can-compute</a></li>
					<li><a href=".">can-component</a></li>
				</ul>
		</li>
		<li>
			<a href="https://gitter.im/canjs/canjs">Chat</a>
		</li>
		<li>
			<a href="http://forums.donejs.com/c/canjs">Forum</a>
		</li>
	</ul>

</nav>
</header>
  	<div class="main-container">
  
  	<nav class="sidebar">
    
        
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-core.html">
							Core
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-ecosystem.html">
							Ecosystem
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-infrastructure.html">
							Infrastructure
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="can-legacy.html">
							Legacy
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="page"
							href="guides.html">
							Guides
						</a>
						
							
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Why.html">
							Why CanJS?
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Using.html">
							Setting up CanJS
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               parent
                               expanded">
						<a class="page"
							href="Tutorial.html">
							Getting Started Tutorial
						</a>
						
							
	<ul>
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Setup.html">
							Setup
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="ApplicationDesign.html">
							Application Design
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Constructors.html">
							Constructors
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Observables.html">
							Observables
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="TheDefinePlugin.html">
							The Define Plugin
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="StacheTemplates.html">
							Stache Templates
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="AppStateAndRouting.html">
							App State and Routing
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Components.html">
							Components
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="ViewModels.html">
							View Models
						</a>
						
					</li>
				

			
		
			
				
					<li class="current
                               parent
                               expanded">
						<a class="page"
							href="DataModelsAndFixtures.html">
							Data Models and Fixtures
						</a>
						
							

						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Routing.html">
							Routing
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="LoadingStates.html">
							Loading States
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="EventHandling.html">
							Event Handling
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="WebServiceCommunication.html">
							Web Service Communication
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Recap.html">
							Recap
						</a>
						
					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="Recipes.html">
							Recipes
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="migrating.html">
							Migrating to 3.0
						</a>
						
					</li>
				

			
		
			
				
					<li class="
                               
                               ">
						<a class="page"
							href="roadmap.html">
							Roadmap
						</a>
						
					</li>
				

			
		
	</ul>


						
					</li>
				

			
		
	</ul>


    
</nav>
  

  <div class="content-container">
    <article>
    	
    		<section class="title">
	<h1>Data Models and Fixtures</h1>
</section>

    	

        

    	
    		
    			<section class="description">
    
</section>

    		
    	

    
    
    
    
    


    	
    		
    			<section class="body">
    <div class="getting-started">
<hr />
<p><strong>In this Chapter</strong></p>
<ul>
<li><code>can.Model</code></li>
<li><code>can.fixture</code></li>
<li>Connecting <code>can.Model</code> with <code>can.Component</code></li>
</ul>
<p>Get the code for: <a href="/guides/examples/PlaceMyOrder/ch-6_canjs-getting-started.zip">chapter: data models and fixtures</a></p>
<hr />
<p>The next item we’re going to go over is <a href="../docs/can.Model.html">can.Model</a>.
Models make interacting with JSON REST services <em>really easy</em>. They do this by
encapsulating most of the code required to connect to a service and managing
the data the service returns. Additionally, <code>can.Model</code> extends
<a href="../docs/can.Map.html">can.Map</a>, meaning that the objects returned have all of
the features of a <code>can.Map</code>, such as being <a href="Observables.html">observable</a>.</p>
<p>For applications requiring real-time, high performance, restful data connections
you should check out <a href="http://connect.canjs.com/">can-connect</a>. For our simple case,
we’ll use <code>can.Model</code> to provide data for our state and city elements from
the last chapter.</p>
<p>First, let’s open the <code>models/state.js</code> file and add the following code:</p>
<pre><code>var State = can.Model.extend({
  findAll: 'GET /api/states'
}, {
  // Include second, empty parameter object to set instanceProperties
});
</code></pre>
<p>Then add the following to <code>models/city.js</code>:</p>
<pre><code>var City = can.Model.extend({
  findAll: 'GET /api/cities'
}, {
  // Include second, empty parameter object to set instanceProperties
});
</code></pre>
<p>Because it is a <a href="../docs/can.Construct.html">can.Construct</a>, <code>can.Model.extend</code>
can take up to three parameters:</p>
<ol>
<li><code>name</code></li>
<li><code>staticProperties</code></li>
<li><code>instanceProperties</code></li>
</ol>
<p>A <code>can.Model</code>’s <code>staticProperties</code> parameter has several reserved properties you
can add that simplify accessing data from a JSON REST service. These
properties are:</p>
<ol>
<li><code>findAll</code></li>
<li><code>findOne</code></li>
<li><code>create</code></li>
<li><code>update</code></li>
<li><code>destroy</code></li>
</ol>
<p>The <code>find*</code>, <code>create</code>, <code>update</code>, and <code>destroy</code> functions are available directly
off of the object definition (i.e., they are static). The <code>destroy</code> function is
available off of specific instances of a <code>can.Model</code>. We’ll see how to
use these below.</p>
<p><strong>Reminder</strong>: The number of parameters you pass in to an <code>extend</code> function is
important. If you pass in a single parameter object, the <code>extend</code> function will
use that to set the <code>instanceProperties</code>. If you pass in two parameter
objects, the <em>first</em> object passed in will be used to set the
<code>staticProperties</code>. The second parameter will be used to set the
<code>instanceProperties</code>. Here, we only want to set the <code>staticProperties</code>, so we
must pass in a second, empty object.</p>
<p>A few examples below illustrate this important point:</p>
<pre><code>var MyModel = can.Model.extend({
  findAll: function () {
    // Static function
  }
}, {
  destroy: function () {
    // Instance function
  }
});

MyModel.findAll(); // Reference a function defined on the constructor

var modelInstance = new MyModel();
modelInstance.destroy(); // Reference a function defined on the prototype
</code></pre>
<h2>The Data for Our Model</h2>
<p>We’re not going to connect to a server to retrieve our data; however, we’re
going to code our model as if we were. How can this possibly work? CanJS
provides a handy utility, <code>can.fixture</code>, that we can use to easily mimic the
functionality of connecting to a server. <code>can.fixture</code>
intercepts an AJAX request and simulates a server response with a file or a
function. You can use <code>can.fixture</code> to develop JavaScript independently of
backend services.</p>
<p><code>can.fixture</code> is not included with the base CanJS package. It’s a good practice
to keep it separate from your production CanJS library, which is why we
downloaded and used it a separate script tag, rather than including it
with our custom download. <em>If you use <code>can.fixture</code> during development, remember
to remove it once you need to connect to your REST services</em>.</p>
<p>Let’s create a fixture that will respond to our requests for the list of states.
Add the following code to the <code>models/fixtures.js</code> file:</p>
<pre><code>can.fixture('GET /api/states', 'models/states.json');
</code></pre>
<p>The first argument to <code>can.fixture</code>, <code>GET /api/states</code>, tells CanJS to
intercept any <code>GET</code> requests to the resource <code>/api/states</code>. The second argument
is a path to a file with the data the fixture will return. Because we’re simulating
a <code>findAll</code> function, we need to return an array. The <code>findAll</code> function
expects an array. By default, if it does not receive one, it will throw an error.
If you need to connect to services that return data that doesn’t match the expected
return type of the <code>find*</code> functions, don’t fret. There are ways to manage this,
which we’ll work with later on.</p>
<p>Let’s also create a fixture that will respond to our requests for the list
of cities for each state. This one is going to be a little different because
we want to be able to return a different list depending on which state is
included in the request. Thankfully, <code>can.fixture</code> is flexible and allows
you to dynamically respond to requests. Let’s add the following code to the
<code>models/fixtures.js</code> file:</p>
<pre><code>can.fixture('GET /api/cities', function(request, response) {
    can.ajax({
        url: 'models/' + request.data.state + '.json',
        success: function(data) {
            response(data);
        }
    });
});
</code></pre>
<p>The first argument to <code>can.fixture</code>, <code>GET /api/cities</code>, is similar to our
restaurants example: we’re setting up this fixture to intercept any <code>GET</code>
requests to <code>/api/cities</code>. The second argument, however, is different: it
is a function that returns the data we want to get when the application makes
a service call. In our example, we’re making an AJAX request (via
<a href="../docs/can.ajax.html">can.ajax</a>) to get the fixture data from a JSON file,
then responding to the request with the data we fetched.</p>
<h2>Connecting the Model to the Component</h2>
<p>It’s time to connect all of this together in our view model. Simply open up
<code>components/restaurant_list/restaurant_list.js</code>, find the states property:</p>
<pre><code>        states: {
            value: [
                {
                    cities: ['Green Bay', 'Milwaukee'],
                    name: 'Wisconsin'
                },
                {
                    cities: ['Detroit', 'Ann Arbor'],
                    name: 'Michigan'
                },
                {
                    cities: ['Chicago', 'Peoria'],
                    name: 'Illinois'
                }
            ]
        },
</code></pre>
<p>and replace it with this:</p>
<pre><code>        states: {
            get: function() {
                return State.findAll({});
            }
        },
</code></pre>
<p>In the same file, find the cities property:</p>
<pre><code>        cities: {
            get: function() {
                var state = this.attr('state');
                return state &amp;&amp; this.attr('citiesByState')[state];
            }
        },
</code></pre>
<p>and replace it with this:</p>
<pre><code>        cities: {
            get: function() {
                var state = this.attr('state');
                return state ? City.findAll({ state: state }) : null;
            }
        },
</code></pre>
<p>You can remove the <code>citiesByState</code> property since we won’t be using it anymore.
Let’s also update the <code>components/restaurant_list/restaurant_list.stache</code> file
to match the changes we made in the view model. The most significant change is
that our <code>cities</code> and <code>states</code> properties now return a <a href="../docs/can.List.plugins.promise.html">promise</a>
instead of just an array. Find the <code>form</code> element:</p>
<pre><code>  &lt;form class=&quot;form&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label&gt;State&lt;/label&gt;
      &lt;select {($value)}=&quot;state&quot;&gt;
        {{^if state}}
        &lt;option value=&quot;&quot;&gt;Choose a state&lt;/option&gt;
        {{/if}}
        {{#each states}}
        &lt;option value=&quot;{{name}}&quot;&gt;{{name}}&lt;/option&gt;
        {{/each}}
      &lt;/select&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label&gt;City&lt;/label&gt;
      &lt;select {($value)}=&quot;city&quot;&gt;
        {{^if city}}
        &lt;option value=&quot;&quot;&gt;Choose a city&lt;/option&gt;
        {{/if}}
        {{#each cities}}
        &lt;option&gt;{{.}}&lt;/option&gt;
        {{/each}}
      &lt;/select&gt;
    &lt;/div&gt;
  &lt;/form&gt;
</code></pre>
<p>and replace it with this new one:</p>
<pre><code>  &lt;form class=&quot;form&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label&gt;State&lt;/label&gt;
      &lt;select {($value)}=&quot;state&quot; {{#if states.isPending}}disabled{{/if}}&gt;
        {{#if states.isPending}}
          &lt;option value=&quot;&quot;&gt;Loading...&lt;/option&gt;
        {{else}}
          {{^if state}}
          &lt;option value=&quot;&quot;&gt;Choose a state&lt;/option&gt;
          {{/if}}
          {{#each states.value}}
          &lt;option value=&quot;{{short}}&quot;&gt;{{name}}&lt;/option&gt;
          {{/each}}
        {{/if}}
      &lt;/select&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label&gt;City&lt;/label&gt;
      &lt;select {($value)}=&quot;city&quot; {{^if state}}disabled{{/if}}&gt;
        {{#if cities.isPending}}
          &lt;option value=&quot;&quot;&gt;Loading...&lt;/option&gt;
        {{else}}
          {{^if city}}
          &lt;option value=&quot;&quot;&gt;Choose a city&lt;/option&gt;
          {{/if}}
          {{#each cities.value}}
          &lt;option&gt;{{name}}&lt;/option&gt;
          {{/each}}
        {{/if}}
      &lt;/select&gt;
    &lt;/div&gt;
  &lt;/form&gt;
</code></pre>
<p>Note that there are a few ways to call a <code>findAll</code> function on a <code>can.Model</code>. The
first way is to call the function explicitly. Using the <code>State</code> model as an
example, that would look like this:</p>
<pre><code>State.findAll({ /* paramsObject */ },
  function(returnedObject){
    // ...
  },
  function(errorObject){
    // ...
  });
</code></pre>
<p>We also have the ability to use <code>can.Deferred</code>, which allows us to chain
callback functions off of each other. You can read more about this from the
<a href="https://api.jquery.com/category/deferred-object/">jQuery API</a>. Using this
method, we could write our <code>findAll</code> like this:</p>
<pre><code>State.findAll({ /* paramsObject */ })
  /* When the API call succeeds, .done() is called */
  .done(function(returnedObject) {
    // ...
  })
  /* When the API call errors, .fails() is called */
  .fail(function(errorObject) {
    // ...
  });
</code></pre>
<p>Both are acceptable, but throughout the guide we will use the Deferred method
as it more explicitly states which callback function is which.</p>
<p>Finally, let’s add the scripts we modified to our <code>index.html</code> file.
Find these lines:</p>
<pre><code>    &lt;!-- Replace with city model script --&gt;
    &lt;!-- Replace with fixtures script --&gt;
    &lt;!-- Replace with state model script --&gt;
</code></pre>
<p>and replace it with these lines:</p>
<pre><code>    &lt;script src=&quot;models/city.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;models/fixtures.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;models/state.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>Let’s go back to our app now and see what happens! If everything went
according to plan, you should be able to refresh the Restaurants page
and see the same list that we had before. Selecting a state, then a city,
should work the same as well.</p>
<p><img src="../can/guides/images/view-models/view_model_city.png" alt="set up state selector" /></p>
<hr />
<p><span class="pull-left"><a href="ViewModels.html">&lsaquo; View Models</a></span>
<span class="pull-right"><a href="LoadingStates.html">Loading States &rsaquo;</a></span></p>
</div>

</section>

    		
    	

    </article>
  </div>
</div>

  <footer><p>CanJS is part of <a href="http://donejs.com">DoneJS</a>. Created and maintained by the open source team at <a href="http://bitovi.com">Bitovi</a>. <strong>Currently v3.0.0.</strong></p></footer>
	<script type="text/javascript">
		var docObject = {"content":"<div class=\"main-container\">\n  \n  \t<nav class=\"sidebar\">\n    \n        \n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-core.html\">\n\t\t\t\t\t\t\tCore\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-ecosystem.html\">\n\t\t\t\t\t\t\tEcosystem\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-infrastructure.html\">\n\t\t\t\t\t\t\tInfrastructure\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"can-legacy.html\">\n\t\t\t\t\t\t\tLegacy\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"guides.html\">\n\t\t\t\t\t\t\tGuides\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Why.html\">\n\t\t\t\t\t\t\tWhy CanJS?\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Using.html\">\n\t\t\t\t\t\t\tSetting up CanJS\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Tutorial.html\">\n\t\t\t\t\t\t\tGetting Started Tutorial\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t<ul>\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Setup.html\">\n\t\t\t\t\t\t\tSetup\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"ApplicationDesign.html\">\n\t\t\t\t\t\t\tApplication Design\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Constructors.html\">\n\t\t\t\t\t\t\tConstructors\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Observables.html\">\n\t\t\t\t\t\t\tObservables\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"TheDefinePlugin.html\">\n\t\t\t\t\t\t\tThe Define Plugin\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"StacheTemplates.html\">\n\t\t\t\t\t\t\tStache Templates\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"AppStateAndRouting.html\">\n\t\t\t\t\t\t\tApp State and Routing\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Components.html\">\n\t\t\t\t\t\t\tComponents\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"ViewModels.html\">\n\t\t\t\t\t\t\tView Models\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"current\n                               parent\n                               expanded\">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"DataModelsAndFixtures.html\">\n\t\t\t\t\t\t\tData Models and Fixtures\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Routing.html\">\n\t\t\t\t\t\t\tRouting\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"LoadingStates.html\">\n\t\t\t\t\t\t\tLoading States\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"EventHandling.html\">\n\t\t\t\t\t\t\tEvent Handling\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"WebServiceCommunication.html\">\n\t\t\t\t\t\t\tWeb Service Communication\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Recap.html\">\n\t\t\t\t\t\t\tRecap\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"Recipes.html\">\n\t\t\t\t\t\t\tRecipes\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"migrating.html\">\n\t\t\t\t\t\t\tMigrating to 3.0\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t\t\t\n\t\t\t\t\n\t\t\t\t\t<li class=\"\n                               \n                               \">\n\t\t\t\t\t\t<a class=\"page\"\n\t\t\t\t\t\t\thref=\"roadmap.html\">\n\t\t\t\t\t\t\tRoadmap\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n\t\t\t\t\t\t\n\t\t\t\t\t</li>\n\t\t\t\t\n\n\t\t\t\n\t\t\n\t</ul>\n\n\n    \n</nav>\n  \n\n  <div class=\"content-container\">\n    <article>\n    \t\n    \t\t<section class=\"title\">\n\t<h1>Data Models and Fixtures</h1>\n</section>\n\n    \t\n\n        \n\n    \t\n    \t\t\n    \t\t\t<section class=\"description\">\n    \n</section>\n\n    \t\t\n    \t\n\n    \n    \n    \n    \n    \n\n\n    \t\n    \t\t\n    \t\t\t<section class=\"body\">\n    <div class=\"getting-started\">\n<hr />\n<p><strong>In this Chapter</strong></p>\n<ul>\n<li><code>can.Model</code></li>\n<li><code>can.fixture</code></li>\n<li>Connecting <code>can.Model</code> with <code>can.Component</code></li>\n</ul>\n<p>Get the code for: <a href=\"/guides/examples/PlaceMyOrder/ch-6_canjs-getting-started.zip\">chapter: data models and fixtures</a></p>\n<hr />\n<p>The next item we’re going to go over is <a href=\"../docs/can.Model.html\">can.Model</a>.\nModels make interacting with JSON REST services <em>really easy</em>. They do this by\nencapsulating most of the code required to connect to a service and managing\nthe data the service returns. Additionally, <code>can.Model</code> extends\n<a href=\"../docs/can.Map.html\">can.Map</a>, meaning that the objects returned have all of\nthe features of a <code>can.Map</code>, such as being <a href=\"Observables.html\">observable</a>.</p>\n<p>For applications requiring real-time, high performance, restful data connections\nyou should check out <a href=\"http://connect.canjs.com/\">can-connect</a>. For our simple case,\nwe’ll use <code>can.Model</code> to provide data for our state and city elements from\nthe last chapter.</p>\n<p>First, let’s open the <code>models/state.js</code> file and add the following code:</p>\n<pre><code>var State = can.Model.extend({\n  findAll: 'GET /api/states'\n}, {\n  // Include second, empty parameter object to set instanceProperties\n});\n</code></pre>\n<p>Then add the following to <code>models/city.js</code>:</p>\n<pre><code>var City = can.Model.extend({\n  findAll: 'GET /api/cities'\n}, {\n  // Include second, empty parameter object to set instanceProperties\n});\n</code></pre>\n<p>Because it is a <a href=\"../docs/can.Construct.html\">can.Construct</a>, <code>can.Model.extend</code>\ncan take up to three parameters:</p>\n<ol>\n<li><code>name</code></li>\n<li><code>staticProperties</code></li>\n<li><code>instanceProperties</code></li>\n</ol>\n<p>A <code>can.Model</code>’s <code>staticProperties</code> parameter has several reserved properties you\ncan add that simplify accessing data from a JSON REST service. These\nproperties are:</p>\n<ol>\n<li><code>findAll</code></li>\n<li><code>findOne</code></li>\n<li><code>create</code></li>\n<li><code>update</code></li>\n<li><code>destroy</code></li>\n</ol>\n<p>The <code>find*</code>, <code>create</code>, <code>update</code>, and <code>destroy</code> functions are available directly\noff of the object definition (i.e., they are static). The <code>destroy</code> function is\navailable off of specific instances of a <code>can.Model</code>. We’ll see how to\nuse these below.</p>\n<p><strong>Reminder</strong>: The number of parameters you pass in to an <code>extend</code> function is\nimportant. If you pass in a single parameter object, the <code>extend</code> function will\nuse that to set the <code>instanceProperties</code>. If you pass in two parameter\nobjects, the <em>first</em> object passed in will be used to set the\n<code>staticProperties</code>. The second parameter will be used to set the\n<code>instanceProperties</code>. Here, we only want to set the <code>staticProperties</code>, so we\nmust pass in a second, empty object.</p>\n<p>A few examples below illustrate this important point:</p>\n<pre><code>var MyModel = can.Model.extend({\n  findAll: function () {\n    // Static function\n  }\n}, {\n  destroy: function () {\n    // Instance function\n  }\n});\n\nMyModel.findAll(); // Reference a function defined on the constructor\n\nvar modelInstance = new MyModel();\nmodelInstance.destroy(); // Reference a function defined on the prototype\n</code></pre>\n<h2>The Data for Our Model</h2>\n<p>We’re not going to connect to a server to retrieve our data; however, we’re\ngoing to code our model as if we were. How can this possibly work? CanJS\nprovides a handy utility, <code>can.fixture</code>, that we can use to easily mimic the\nfunctionality of connecting to a server. <code>can.fixture</code>\nintercepts an AJAX request and simulates a server response with a file or a\nfunction. You can use <code>can.fixture</code> to develop JavaScript independently of\nbackend services.</p>\n<p><code>can.fixture</code> is not included with the base CanJS package. It’s a good practice\nto keep it separate from your production CanJS library, which is why we\ndownloaded and used it a separate script tag, rather than including it\nwith our custom download. <em>If you use <code>can.fixture</code> during development, remember\nto remove it once you need to connect to your REST services</em>.</p>\n<p>Let’s create a fixture that will respond to our requests for the list of states.\nAdd the following code to the <code>models/fixtures.js</code> file:</p>\n<pre><code>can.fixture('GET /api/states', 'models/states.json');\n</code></pre>\n<p>The first argument to <code>can.fixture</code>, <code>GET /api/states</code>, tells CanJS to\nintercept any <code>GET</code> requests to the resource <code>/api/states</code>. The second argument\nis a path to a file with the data the fixture will return. Because we’re simulating\na <code>findAll</code> function, we need to return an array. The <code>findAll</code> function\nexpects an array. By default, if it does not receive one, it will throw an error.\nIf you need to connect to services that return data that doesn’t match the expected\nreturn type of the <code>find*</code> functions, don’t fret. There are ways to manage this,\nwhich we’ll work with later on.</p>\n<p>Let’s also create a fixture that will respond to our requests for the list\nof cities for each state. This one is going to be a little different because\nwe want to be able to return a different list depending on which state is\nincluded in the request. Thankfully, <code>can.fixture</code> is flexible and allows\nyou to dynamically respond to requests. Let’s add the following code to the\n<code>models/fixtures.js</code> file:</p>\n<pre><code>can.fixture('GET /api/cities', function(request, response) {\n    can.ajax({\n        url: 'models/' + request.data.state + '.json',\n        success: function(data) {\n            response(data);\n        }\n    });\n});\n</code></pre>\n<p>The first argument to <code>can.fixture</code>, <code>GET /api/cities</code>, is similar to our\nrestaurants example: we’re setting up this fixture to intercept any <code>GET</code>\nrequests to <code>/api/cities</code>. The second argument, however, is different: it\nis a function that returns the data we want to get when the application makes\na service call. In our example, we’re making an AJAX request (via\n<a href=\"../docs/can.ajax.html\">can.ajax</a>) to get the fixture data from a JSON file,\nthen responding to the request with the data we fetched.</p>\n<h2>Connecting the Model to the Component</h2>\n<p>It’s time to connect all of this together in our view model. Simply open up\n<code>components/restaurant_list/restaurant_list.js</code>, find the states property:</p>\n<pre><code>        states: {\n            value: [\n                {\n                    cities: ['Green Bay', 'Milwaukee'],\n                    name: 'Wisconsin'\n                },\n                {\n                    cities: ['Detroit', 'Ann Arbor'],\n                    name: 'Michigan'\n                },\n                {\n                    cities: ['Chicago', 'Peoria'],\n                    name: 'Illinois'\n                }\n            ]\n        },\n</code></pre>\n<p>and replace it with this:</p>\n<pre><code>        states: {\n            get: function() {\n                return State.findAll({});\n            }\n        },\n</code></pre>\n<p>In the same file, find the cities property:</p>\n<pre><code>        cities: {\n            get: function() {\n                var state = this.attr('state');\n                return state &amp;&amp; this.attr('citiesByState')[state];\n            }\n        },\n</code></pre>\n<p>and replace it with this:</p>\n<pre><code>        cities: {\n            get: function() {\n                var state = this.attr('state');\n                return state ? City.findAll({ state: state }) : null;\n            }\n        },\n</code></pre>\n<p>You can remove the <code>citiesByState</code> property since we won’t be using it anymore.\nLet’s also update the <code>components/restaurant_list/restaurant_list.stache</code> file\nto match the changes we made in the view model. The most significant change is\nthat our <code>cities</code> and <code>states</code> properties now return a <a href=\"../docs/can.List.plugins.promise.html\">promise</a>\ninstead of just an array. Find the <code>form</code> element:</p>\n<pre><code>  &lt;form class=&quot;form&quot;&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n      &lt;label&gt;State&lt;/label&gt;\n      &lt;select {($value)}=&quot;state&quot;&gt;\n        {{^if state}}\n        &lt;option value=&quot;&quot;&gt;Choose a state&lt;/option&gt;\n        {{/if}}\n        {{#each states}}\n        &lt;option value=&quot;{{name}}&quot;&gt;{{name}}&lt;/option&gt;\n        {{/each}}\n      &lt;/select&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n      &lt;label&gt;City&lt;/label&gt;\n      &lt;select {($value)}=&quot;city&quot;&gt;\n        {{^if city}}\n        &lt;option value=&quot;&quot;&gt;Choose a city&lt;/option&gt;\n        {{/if}}\n        {{#each cities}}\n        &lt;option&gt;{{.}}&lt;/option&gt;\n        {{/each}}\n      &lt;/select&gt;\n    &lt;/div&gt;\n  &lt;/form&gt;\n</code></pre>\n<p>and replace it with this new one:</p>\n<pre><code>  &lt;form class=&quot;form&quot;&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n      &lt;label&gt;State&lt;/label&gt;\n      &lt;select {($value)}=&quot;state&quot; {{#if states.isPending}}disabled{{/if}}&gt;\n        {{#if states.isPending}}\n          &lt;option value=&quot;&quot;&gt;Loading...&lt;/option&gt;\n        {{else}}\n          {{^if state}}\n          &lt;option value=&quot;&quot;&gt;Choose a state&lt;/option&gt;\n          {{/if}}\n          {{#each states.value}}\n          &lt;option value=&quot;{{short}}&quot;&gt;{{name}}&lt;/option&gt;\n          {{/each}}\n        {{/if}}\n      &lt;/select&gt;\n    &lt;/div&gt;\n    &lt;div class=&quot;form-group&quot;&gt;\n      &lt;label&gt;City&lt;/label&gt;\n      &lt;select {($value)}=&quot;city&quot; {{^if state}}disabled{{/if}}&gt;\n        {{#if cities.isPending}}\n          &lt;option value=&quot;&quot;&gt;Loading...&lt;/option&gt;\n        {{else}}\n          {{^if city}}\n          &lt;option value=&quot;&quot;&gt;Choose a city&lt;/option&gt;\n          {{/if}}\n          {{#each cities.value}}\n          &lt;option&gt;{{name}}&lt;/option&gt;\n          {{/each}}\n        {{/if}}\n      &lt;/select&gt;\n    &lt;/div&gt;\n  &lt;/form&gt;\n</code></pre>\n<p>Note that there are a few ways to call a <code>findAll</code> function on a <code>can.Model</code>. The\nfirst way is to call the function explicitly. Using the <code>State</code> model as an\nexample, that would look like this:</p>\n<pre><code>State.findAll({ /* paramsObject */ },\n  function(returnedObject){\n    // ...\n  },\n  function(errorObject){\n    // ...\n  });\n</code></pre>\n<p>We also have the ability to use <code>can.Deferred</code>, which allows us to chain\ncallback functions off of each other. You can read more about this from the\n<a href=\"https://api.jquery.com/category/deferred-object/\">jQuery API</a>. Using this\nmethod, we could write our <code>findAll</code> like this:</p>\n<pre><code>State.findAll({ /* paramsObject */ })\n  /* When the API call succeeds, .done() is called */\n  .done(function(returnedObject) {\n    // ...\n  })\n  /* When the API call errors, .fails() is called */\n  .fail(function(errorObject) {\n    // ...\n  });\n</code></pre>\n<p>Both are acceptable, but throughout the guide we will use the Deferred method\nas it more explicitly states which callback function is which.</p>\n<p>Finally, let’s add the scripts we modified to our <code>index.html</code> file.\nFind these lines:</p>\n<pre><code>    &lt;!-- Replace with city model script --&gt;\n    &lt;!-- Replace with fixtures script --&gt;\n    &lt;!-- Replace with state model script --&gt;\n</code></pre>\n<p>and replace it with these lines:</p>\n<pre><code>    &lt;script src=&quot;models/city.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;models/fixtures.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;models/state.js&quot;&gt;&lt;/script&gt;\n</code></pre>\n<p>Let’s go back to our app now and see what happens! If everything went\naccording to plan, you should be able to refresh the Restaurants page\nand see the same list that we had before. Selecting a state, then a city,\nshould work the same as well.</p>\n<p><img src=\"../can/guides/images/view-models/view_model_city.png\" alt=\"set up state selector\" /></p>\n<hr />\n<p><span class=\"pull-left\"><a href=\"ViewModels.html\">&lsaquo; View Models</a></span>\n<span class=\"pull-right\"><a href=\"LoadingStates.html\">Loading States &rsaquo;</a></span></p>\n</div>\n\n</section>\n\n    \t\t\n    \t\n\n    </article>\n  </div>\n</div>\n","src":{"path":"docs/can-guides/getting-started-tutorial/data-models-and-fixtures.md"},"description":"\n","name":"DataModelsAndFixtures","title":"Data Models and Fixtures","type":"page","parent":"Tutorial","order":9,"disabletableofcontents":true,"comment":" "};
	</script>

	
		<script>
		  steal = {
		    instantiated: {
		      "bundles/bit-docs-site/static.css!$css" : null
		    }
		  }
		</script>
		<script type='text/javascript'
				data-main="bit-docs-site/static"
				src="./static/node_modules/steal/steal.production.js"></script>
	
</body>

</html>
